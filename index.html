<!-- filepath: c:\Users\LENOVO\map pointing\1.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriMapFarm - Ultimate Enterprise</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --primary: #27ae60; --glass: rgba(255, 255, 255, 0.95); --dark: #1a1a1a; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        header { 
            background: var(--glass); padding: 10px 20px; display: flex; align-items: center; 
            justify-content: space-between; z-index: 2000; box-shadow: 0 2px 10px rgba(192, 255, 17, 0.959).1);
        }
        .search-box { position: relative; flex: 0.6; margin: 0 20px; }
        .search-box input { width: 100%; padding: 10px 40px; border-radius: 25px; border: 1px solid #ddd; outline: none; }
        .search-box i { position: absolute; left: 15px; top: 12px; color: #96f007ecf6; }

        .content { display: flex; flex: 1; overflow: hidden; position: relative; }
        #map { flex: 1; }
        
        .sidebar { width: 420px; background: rgb(247, 191, 39)erflow-y: auto; border-left: 1px solid #ddd; padding: 15px; z-index: 1001; }

        /* AI Assistant Chat */
        .ai-chat-box { 
            position: fixed; bottom: 20px; right: 20px; z-index: 2500; width: 350px; 
            background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); 
            display: none; flex-direction: column; max-height: 500px;
        }
        .ai-header { background: var(--primary); color: white; padding: 15px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .ai-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 85%; }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; }
        .msg.ai { background: #f0f0f0; align-self: flex-start; }
        .ai-input { display: flex; gap: 5px; padding: 10px; border-top: 1px solid #ddd; }
        .ai-input input { flex: 1; padding: 8px; border-radius: 5px; border: 1px solid #ddd; }
        .ai-input button { padding: 8px 15px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* Expanded Complaint Form */
        .complaint-section { 
            display: none; background: #fff5f5; padding: 15px; border-radius: 10px; 
            border: 1px solid #e7f524; margin-top: 20px; max-height: 600px; overflow-y: auto;
        }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-weight: bold; font-size: 13px; margin-bottom: 5px; }
        .form-group select, .form-group input, .form-group textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }

        /* Document Manager */
        .doc-section { background: #e8f5e9; padding: 15px; border-radius: 10px; margin: 15px 0; border: 1px solid #4caf50; }
        .doc-btn { display: block; width: 100%; padding: 10px; margin: 5px 0; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .doc-btn:hover { background: #d8fa1a; }

        /* Admin Overlay */
        #admin-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); z-index: 3000; color: white; padding: 40px; 
            overflow-y: auto;
        }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 30px; }
        .admin-card { background: #333; padding: 20px; border-radius: 10px; }
        .admin-card h3 { margin-top: 0; }
        .admin-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .admin-tabs button { padding: 10px 20px; background: #555; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .admin-tabs button.active { background: var(--primary); }
        .admin-content { display: none; }
        .admin-content.active { display: block; }

        .floating-controls { position: absolute; bottom: 20px; left: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .weather-card { background: var(--glass); padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        .btn { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-admin { background: var(--dark); color: white; }
        
        .profile-section { text-align: center; }
        .profile-img { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; }

        .tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid #ddd; }
        .tab-btn { padding: 10px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: bold; color: #888; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center;">
        <i class="fa-solid fa-map-marked-alt" style="font-size: 24px; color: var(--primary); margin-right: 10px;"></i>
        <h2 style="margin:0;">AgriMapFarm</h2>
    </div>

    <div class="search-box">
        <i class="fa-solid fa-search"></i>
        <input type="text" placeholder="Search Farmer, Village..." id="mapSearch">
    </div>

    <div style="display:flex; gap: 10px; align-items: center;">
        <select id="langSwitch" class="btn" style="background:#eee;">
            <option value="en">English</option>
            <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        </select>
        <button class="btn btn-admin" onclick="toggleAdmin()">Admin Portal</button>
        <button class="btn btn-primary" onclick="toggleAIChat()" title="AI Assistant"><i class="fa-solid fa-robot"></i></button>
    </div>
</header>

<!-- AI Chat Assistant -->
<div class="ai-chat-box" id="aiChat">
    <div class="ai-header">
        <span><i class="fa-solid fa-robot"></i> AgriMap AI Assistant</span>
        <button onclick="toggleAIChat()" style="background:none; border:none; color:white; cursor:pointer; font-size:18px;">‚úï</button>
    </div>
    <div class="ai-messages" id="aiMessages"></div>
    <div class="ai-input">
        <input type="text" id="aiInput" placeholder="Ask about crops, complaints, docs..." onkeypress="handleAIInput(event)">
        <button onclick="sendAIMessage()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
</div>

<div class="content">
    <div id="map"></div>

    <div class="floating-controls">
        <div class="weather-card">
            <h4 style="margin:0 0 5px 0;"><i class="fa-solid fa-cloud-sun"></i> Live Weather</h4>
            <div id="live-temp">32¬∞C - Clear Sky</div>
            <div style="font-size:12px; color:#666;">Humidity: 45% | Wind: 12km/h</div>
        </div>
        <button class="btn btn-primary" onclick="toggleSatellite()">üõ∞Ô∏è Satellite View</button>
    </div>

    <div class="sidebar">
        <div id="welcome-msg" style="text-align:center; padding:50px 0;">
            <i class="fa-solid fa-hand-pointer" style="font-size:40px; color:#ccc;"></i>
            <p>Select a pointer on map to view member details</p>
        </div>

        <div id="farmer-display" style="display:none;">
            <div class="profile-section">
                <img src="" id="f-img" class="profile-img">
                <h3 id="f-name" style="margin:10px 0;"></h3>
                <p id="f-contact" style="color:#666; margin:5px 0;"></p>
            </div>

            <!-- Tab Navigation -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('details')">Details</button>
                <button class="tab-btn" onclick="switchTab('docs')">Documents</button>
                <button class="tab-btn" onclick="switchTab('complaint')">Complaint</button>
            </div>

            <!-- Details Tab -->
            <div class="tab-content active" id="details-tab">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:13px;" id="f-data"></div>
                <canvas id="cropChart" style="margin-top:20px;"></canvas>
            </div>

            <!-- Documents Tab -->
            <div class="tab-content" id="docs-tab">
                <div class="doc-section">
                    <h4 style="margin-top:0;">Land Documents</h4>
                    <button class="doc-btn" onclick="downloadPDF('land-title')">
                        <i class="fa-solid fa-download"></i> Land Title Deed
                    </button>
                    <button class="doc-btn" onclick="downloadPDF('survey')">
                        <i class="fa-solid fa-download"></i> Land Survey Report
                    </button>
                    <button class="doc-btn" onclick="downloadExcel('records')">
                        <i class="fa-solid fa-download"></i> Land Records (Excel)
                    </button>
                </div>
                <div class="doc-section">
                    <h4>Crop Documents</h4>
                    <button class="doc-btn" onclick="downloadPDF('crop-report')">
                        <i class="fa-solid fa-download"></i> Crop Yield Report
                    </button>
                    <button class="doc-btn" onclick="downloadPDF('insurance')">
                        <i class="fa-solid fa-download"></i> Insurance Details
                    </button>
                </div>
                <div class="doc-section">
                    <h4>Subsidy & Loan</h4>
                    <button class="doc-btn" onclick="downloadPDF('subsidy')">
                        <i class="fa-solid fa-download"></i> Subsidy Claims
                    </button>
                    <button class="doc-btn" onclick="downloadPDF('loan')">
                        <i class="fa-solid fa-download"></i> Loan Documents
                    </button>
                </div>
            </div>

            <!-- Complaint Tab -->
            <div class="tab-content" id="complaint-tab">
                <div class="complaint-section" id="complaintForm" style="display:block; margin-top:0;">
                    <h4 style="margin-top:0;">File Complaint</h4>
                    <div class="form-group">
                        <label>Department</label>
                        <select id="dept">
                            <option>Agriculture Revenue</option>
                            <option>Irrigation Department</option>
                            <option>Private Bank/Loan</option>
                            <option>Land Registry</option>
                            <option>Crop Insurance</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Issue Category</label>
                        <select id="issueType">
                            <option>Crop Loss</option>
                            <option>Land Dispute</option>
                            <option>Payment Delay</option>
                            <option>Pest/Disease Damage</option>
                            <option>Water Rights</option>
                            <option>Subsidy Not Received</option>
                            <option>Land Records Error</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Sub-Category</label>
                        <select id="subCategory">
                            <option>Act of God</option>
                            <option>Negligence</option>
                            <option>Administrative Error</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estimated Loss Amount (‚Çπ)</label>
                        <input type="number" id="lossAmount" placeholder="Enter amount">
                    </div>
                    <div class="form-group">
                        <label>Priority Level</label>
                        <input type="range" id="priority" min="1" max="5">
                        <span id="priorityVal">3 - Medium</span>
                    </div>
                    <div class="form-group">
                        <label>Supporting Documents</label>
                        <input type="file" id="docUpload" multiple accept=".pdf,.jpg,.png,.doc,.docx">
                    </div>
                    <div class="form-group">
                        <label>Detailed Description</label>
                        <textarea id="complaintDesc" rows="4" placeholder="Describe your issue in detail..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox"> I agree to the terms and conditions
                        </label>
                    </div>
                    <button class="btn btn-primary" style="width:100%; background:#c0392b;" onclick="submitComplaint()">
                        Submit Complaint
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Admin Portal -->
<div id="admin-overlay">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Admin Control Dashboard</h1>
        <button class="btn btn-primary" onclick="toggleAdmin()">Close Portal</button>
    </div>

    <div class="admin-tabs">
        <button class="admin-tab-btn active" onclick="switchAdminTab('overview')">Overview</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('users')">User Management</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('complaints')">Complaints</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('land')">Land Records</button>
        <button class="admin-tab-btn" onclick="switchAdminTab('analytics')">Analytics</button>
    </div>

    <!-- Overview Tab -->
    <div class="admin-content active" id="overview-tab">
        <div class="admin-grid">
            <div class="admin-card">
                <h3>Total Farmers</h3>
                <p style="font-size:24px; color:var(--primary);">1,240</p>
                <button class="btn btn-primary" style="width:100%;">View All</button>
            </div>
            <div class="admin-card">
                <h3>Active Complaints</h3>
                <p style="font-size:24px; color:#f39c12;">45</p>
                <button class="btn btn-primary" style="width:100%;">Manage Tickets</button>
            </div>
            <div class="admin-card">
                <h3>Land Records</h3>
                <p style="font-size:24px; color:#3498db;">892/1000</p>
                <button class="btn btn-primary" style="width:100%;">Update Database</button>
            </div>
        </div>
    </div>

    <!-- User Management Tab -->
    <div class="admin-content" id="users-tab">
        <h2>User Management</h2>
        <table style="width:100%; border-collapse:collapse; color:white;">
            <thead>
                <tr style="background:#555;">
                    <th style="padding:10px; text-align:left;">Farmer ID</th>
                    <th>Name</th>
                    <th>Village</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="usersTable">
                <tr style="border-bottom:1px solid #555;">
                    <td style="padding:10px;">F-001</td>
                    <td>Farmer 1</td>
                    <td>Eluru</td>
                    <td>9876543210</td>
                    <td style="color:#4caf50;">Active</td>
                    <td><button class="btn btn-primary" style="padding:5px 10px;">Edit</button></td>
                </tr>
            </tbody>
        </table>
        <button class="btn btn-primary" style="margin-top:20px;">Add New User</button>
    </div>

    <!-- Complaints Tab -->
    <div class="admin-content" id="complaints-tab">
        <h2>Complaint Management</h2>
        <div style="background:#333; padding:15px; border-radius:5px; margin-bottom:15px;">
            <p><strong>Pending:</strong> 45 | <strong>In Progress:</strong> 30 | <strong>Resolved:</strong> 120 | <strong>Closed:</strong> 95</p>
        </div>
        <table style="width:100%; border-collapse:collapse; color:white;">
            <thead>
                <tr style="background:#555;">
                    <th style="padding:10px; text-align:left;">Ticket ID</th>
                    <th>Farmer</th>
                    <th>Issue</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr style="border-bottom:1px solid #555;">
                    <td style="padding:10px;">T-001</td>
                    <td>Farmer 1</td>
                    <td>Crop Loss</td>
                    <td>2024-01-15</td>
                    <td style="color:#f39c12;">Pending</td>
                    <td><button class="btn btn-primary" style="padding:5px 10px;">Review</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Land Records Tab -->
    <div class="admin-content" id="land-tab">
        <h2>Land Records Management</h2>
        <div style="background:#333; padding:15px; border-radius:5px; margin-bottom:15px;">
            <p><strong>Total Land:</strong> 5,240 acres | <strong>Verified:</strong> 4,663 (89%) | <strong>Pending:</strong> 577 (11%)</p>
        </div>
        <button class="btn btn-primary" style="margin-right:10px;">
            <i class="fa-solid fa-upload"></i> Bulk Upload Records
        </button>
        <button class="btn btn-primary">
            <i class="fa-solid fa-download"></i> Export All Records
        </button>
    </div>

    <!-- Analytics Tab -->
    <div class="admin-content" id="analytics-tab">
        <h2>System Analytics</h2>
        <div class="admin-grid">
            <div class="admin-card">
                <h3>Complaint Resolution Rate</h3>
                <p style="font-size:32px; color:var(--primary);">73%</p>
            </div>
            <div class="admin-card">
                <h3>Avg Response Time</h3>
                <p style="font-size:32px; color:#f39c12;">2.4 days</p>
            </div>
            <div class="admin-card">
                <h3>User Satisfaction</h3>
                <p style="font-size:32px; color:#3498db;">4.6/5</p>
            </div>
        </div>
    </div>
</div>

<script>
    // ===== API KEYS & CONFIG =====
    const CONFIG = {
        // Replace with your actual API keys
        UNSPLASH_API: 'YOUR_UNSPLASH_API_KEY_HERE',
        OPENWEATHER_API: 'YOUR_OPENWEATHER_API_KEY_HERE',
        LOCATION_API: 'https://nominatim.openstreetmap.org/reverse',
        GOOGLE_PLACES_API: 'YOUR_GOOGLE_PLACES_API_KEY_HERE'
    };

    // ===== MAP SETUP =====
    const map = L.map('map').setView([16.8, 81.5], 9);
    const streetTiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    const satTiles = L.tileLayer('https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {subdomains:['mt0','mt1','mt2','mt3']});

    function toggleSatellite() {
        if (map.hasLayer(streetTiles)) { map.removeLayer(streetTiles); satTiles.addTo(map); }
        else { map.removeLayer(satTiles); streetTiles.addTo(map); }
    }

    function toggleAdmin() {
        document.getElementById('admin-overlay').style.display = 
            document.getElementById('admin-overlay').style.display === 'block' ? 'none' : 'block';
    }

    function toggleAIChat() {
        document.getElementById('aiChat').style.display = 
            document.getElementById('aiChat').style.display === 'none' ? 'flex' : 'none';
    }

    // ===== TAB SWITCHING =====
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab + '-tab').classList.add('active');
        event.target.classList.add('active');
    }

    function switchAdminTab(tab) {
        document.querySelectorAll('.admin-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.admin-tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tab + '-tab').classList.add('active');
        event.target.classList.add('active');
    }

    // ===== FARMER DATA WITH REAL PHOTOS =====
    function getFarmers(vid) {
        let arr = [];
        for(let i=1; i<=20; i++) {
            arr.push({
                id: `F-${vid}-${i}`,
                name: "Farmer " + vid + "-" + i,
                phone: "98765" + String(40000 + i*100).slice(-5),
                email: `farmer${i}@agrimap.com`,
                village: ["Eluru", "Rajahmundry", "Bhimavaram", "Kakinada"][vid],
                acres: (Math.random()*15 + 2).toFixed(1),
                yrs: Math.floor(Math.random()*20 + 5),
                val: "‚Çπ"+Math.floor(Math.random()*30 + 10)+"L",
                curr: "‚Çπ"+Math.floor(Math.random()*60 + 30)+"L",
                rev: "‚Çπ"+(Math.random()*10 + 2).toFixed(1)+"L/yr",
                crops: ["Paddy", "Cotton", "Banana", "Chillies"][Math.floor(Math.random()*4)],
                photo: `https://i.pravatar.cc/150?u=${i}&s=200` // Real placeholder photos
            });
        }
        return arr;
    }

    // ===== ADD MARKERS TO MAP =====
    const locations = [
        {name: "Eluru", lat: 16.7107, lng: 81.1035},
        {name: "Rajahmundry", lat: 17.0005, lng: 81.7729},
        {name: "Bhimavaram", lat: 16.5449, lng: 81.5212},
        {name: "Kakinada", lat: 16.9891, lng: 82.2475},
        {name: "Tadepalligudem", lat: 16.8333, lng: 81.5167},
        {name: "Jangareddygudem", lat: 17.1167, lng: 81.3167},
        {name: "Narsapur", lat: 16.4333, lng: 81.7000},
        {name: "Palakollu", lat: 16.5333, lng: 81.7333},
        {name: "Tanuku", lat: 16.7500, lng: 81.7000},
        {name: "Madhurapudi", lat: 17.0500, lng: 81.7500},
        {name: "Gopalapuram", lat: 16.9000, lng: 81.6000},
        {name: "Dwarapudi", lat: 16.8500, lng: 81.8000},
        {name: "Kovvur", lat: 17.1000, lng: 81.2000},
        {name: "Chintalapudi", lat: 16.7000, lng: 81.4000},
        {name: "Devarapalli", lat: 16.6500, lng: 81.9000},
        {name: "Pedapudi", lat: 16.8000, lng: 81.3000},
        {name: "Unguturu", lat: 16.7500, lng: 81.6000},
        {name: "Denduluru", lat: 16.9000, lng: 81.5000},
        {name: "Chagallu", lat: 16.8500, lng: 81.7000},
        {name: "Koyyalagudem", lat: 16.8000, lng: 81.8000},
        {name: "Polavaram", lat: 16.9000, lng: 81.9000},
        {name: "Buttayagudem", lat: 16.7000, lng: 81.5000},
        {name: "Yelamanchili", lat: 16.7500, lng: 81.4000},
        {name: "Iragavaram", lat: 16.8500, lng: 81.6000},
        {name: "Kadiam", lat: 16.9000, lng: 81.7000},
        {name: "Pedavegi", lat: 16.8000, lng: 81.2000},
        {name: "Nidadavole", lat: 16.9500, lng: 81.8000},
        {name: "Anaparti", lat: 17.0500, lng: 81.6000},
        {name: "Mandapeta", lat: 16.9500, lng: 81.5000},
        {name: "Rajanagaram", lat: 17.0000, lng: 81.7000},
        {name: "Ravulapalem", lat: 16.8500, lng: 81.9000},
        {name: "Kothapalli", lat: 16.7500, lng: 81.7000},
        {name: "Gokavaram", lat: 16.9000, lng: 81.4000},
        {name: "Peddapuram", lat: 16.8500, lng: 81.3000},
        {name: "Sakhinetipalli", lat: 16.8000, lng: 81.9000},
        {name: "Razole", lat: 16.7500, lng: 81.5000},
        {name: "Kumaram Bheem", lat: 16.9000, lng: 81.6000},
        {name: "Mummidivaram", lat: 16.8500, lng: 81.8000},
        {name: "Gollaprolu", lat: 16.8000, lng: 81.4000},
        {name: "Pithapuram", lat: 16.7500, lng: 81.3000},
        {name: "Kakinada Rural", lat: 16.9000, lng: 81.5000},
        {name: "Kakinada Urban", lat: 16.8500, lng: 81.7000}
        
    ];

    locations.forEach((loc, idx) => {
        let m = L.marker([loc.lat, loc.lng]).addTo(map);
        let fList = getFarmers(idx);
        let html = `<b>${loc.name} (20 Members)</b><div style="max-height:150px; overflow-y:auto; margin-top:5px;">`;
        fList.forEach(f => {
            html += `<div onclick='showFarmer(${JSON.stringify(f)})' style="cursor:pointer; padding:5px; border-bottom:1px solid #eee; font-size:12px;">üë§ ${f.name} (${f.phone})</div>`;
        });
        html += `</div>`;
        m.bindPopup(html);
    });

    // ===== DISPLAY FARMER DETAILS =====
    let chart;
    function showFarmer(f) {
        document.getElementById('welcome-msg').style.display = 'none';
        document.getElementById('farmer-display').style.display = 'block';
        
        document.getElementById('f-name').innerText = f.name;
        document.getElementById('f-contact').innerText = `${f.phone} | ${f.email}`;
        document.getElementById('f-img').src = f.photo;
        
        document.getElementById('f-data').innerHTML = `
            <div style="background:#f9f9f9; padding:8px;"><b>ID:</b> ${f.id}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Village:</b> ${f.village}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Acres:</b> ${f.acres}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Experience:</b> ${f.yrs} Yrs</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Bought @:</b> ${f.val}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Present Val:</b> ${f.curr}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Revenue:</b> ${f.rev}</div>
            <div style="background:#f9f9f9; padding:8px;"><b>Main Crop:</b> ${f.crops}</div>
        `;

        if(chart) chart.destroy();
        chart = new Chart(document.getElementById('cropChart'), {
            type: 'pie',
            data: {
                labels: ['Paddy', 'Banana', 'Other'],
                datasets: [{ data: [65, 20, 15], backgroundColor: ['#27ae60', '#f1c40f', '#3498db'] }]
            }
        });
    }

    // ===== DOCUMENT DOWNLOADS =====
    function downloadPDF(type) {
        const farmerName = document.getElementById('f-name').innerText;
        const content = `
            AGRIMAP PRO - ${type.toUpperCase().replace('-', ' ')}
            
            Farmer: ${farmerName}
            Generated: ${new Date().toLocaleDateString()}
            
            This is a sample document. In production, integrate with actual document generation API.
        `;
        
        const element = document.createElement("a");
        element.href = "data:text/plain;charset=utf-8," + encodeURIComponent(content);
        element.download = `${type}_${Date.now()}.txt`;
        element.click();
        alert(`${type} document downloaded!`);
    }

    function downloadExcel(type) {
        alert(`Excel file for ${type} will be generated and downloaded`);
        // Integrate with libraries like SheetJS for actual Excel generation
    }

    // ===== COMPLAINT SUBMISSION =====
    function submitComplaint() {
        const complaint = {
            farmer: document.getElementById('f-name').innerText,
            department: document.getElementById('dept').value,
            issueType: document.getElementById('issueType').value,
            lossAmount: document.getElementById('lossAmount').value,
            priority: document.getElementById('priority').value,
            description: document.getElementById('complaintDesc').value,
            timestamp: new Date().toISOString()
        };
        
        console.log('Complaint submitted:', complaint);
        alert('Complaint submitted! Ticket ID: TKT-' + Date.now());
    }

    // Priority slider update
    document.addEventListener('DOMContentLoaded', () => {
        const prioritySlider = document.getElementById('priority');
        if(prioritySlider) {
            prioritySlider.addEventListener('input', (e) => {
                const levels = ['Low', 'Low-Medium', 'Medium', 'Medium-High', 'High'];
                document.getElementById('priorityVal').innerText = e.target.value + ' - ' + levels[e.target.value - 1];
            });
        }
    });

    // ===== AI ASSISTANT =====
    const aiResponses = {
        'crop': 'I can help with crop management. Which crop are you interested in?',
        'complaint': 'You can file a detailed complaint through the Complaint tab. What issue are you facing?',
        'document': 'All land documents and records are available in the Documents tab for download.',
        'land': 'Land information and survey reports are in the Documents section.',
        'subsidy': 'Subsidy and loan documents are available. Please check the Documents tab.',
        'insurance': 'Crop insurance details can be downloaded from the Documents section.',
        default: 'How can I help? Ask me about crops, complaints, documents, subsidies, or land records.'
    };

    function sendAIMessage() {
        const input = document.getElementById('aiInput');
        const msg = input.value.trim();
        if(!msg) return;

        // User message
        addAIMessage(msg, 'user');
        
        // Find response
        let response = aiResponses['default'];
        for(let key in aiResponses) {
            if(msg.toLowerCase().includes(key)) {
                response = aiResponses[key];
                break;
            }
        }
        
        // AI response
        setTimeout(() => addAIMessage(response, 'ai'), 500);
        input.value = '';
    }

    function addAIMessage(text, sender) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${sender}`;
        msgDiv.innerText = text;
        document.getElementById('aiMessages').appendChild(msgDiv);
        document.getElementById('aiMessages').scrollTop = document.getElementById('aiMessages').scrollHeight;
    }

    function handleAIInput(e) {
        if(e.key === 'Enter') sendAIMessage();
    }
</script>
</body>
</html>